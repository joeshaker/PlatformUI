<!-- Analytics Page -->
<div class="analytics-page">
  <div class="page-header mb-4">
    <h3><i class="fas fa-chart-line me-2"></i>Analytics & Reports</h3>
    <p class="text-muted">Course platform insights and performance metrics</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading analytics data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && !analytics" class="text-center py-5">
    <div class="alert alert-warning" role="alert">
      <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
      <h5>Unable to load analytics</h5>
      <p class="mb-0">Please try refreshing the page or contact support if the problem persists.</p>
    </div>
  </div>

  <!-- Analytics Content -->
  <div *ngIf="!loading && analytics">
    <!-- Overview Stats -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card users">
          <div class="stats-icon">
            <i class="fas fa-user-graduate"></i>
          </div>
          <div class="stats-content">
            <h3>{{ analytics.totalStudents | number }}</h3>
            <p class="text-muted mb-0">Total Students</p>
            <small class="text-success">
              <i class="fas fa-arrow-up"></i> {{ analytics.activeStudents }} active
            </small>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card products">
          <div class="stats-icon">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <div class="stats-content">
            <h3>{{ analytics.totalCourses | number }}</h3>
            <p class="text-muted mb-0">Total Courses</p>
            <small class="text-info">
              <i class="fas fa-book"></i> Active courses
            </small>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card orders">
          <div class="stats-icon">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="stats-content">
            <h3>{{ analytics.totalEnrollments | number }}</h3>
            <p class="text-muted mb-0">Total Enrollments</p>
            <small class="text-success">
              <i class="fas fa-chart-line"></i> Growing
            </small>
          </div>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card revenue">
          <div class="stats-icon">
            <i class="fas fa-chalkboard-teacher"></i>
          </div>
          <div class="stats-content">
            <h3>{{ analytics.totalInstructors | number }}</h3>
            <p class="text-muted mb-0">Total Instructors</p>
            <small class="text-warning" *ngIf="analytics.pendingInstructors > 0">
              <i class="fas fa-clock"></i> {{ analytics.pendingInstructors }} pending verification
            </small>
            <small class="text-success" *ngIf="analytics.pendingInstructors === 0">
              <i class="fas fa-check-circle"></i> All verified
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="row">
      <!-- Sales Chart -->
      <div class="col-lg-8 mb-4">
        <div class="chart-card">
          <div class="chart-header">
            <h5><i class="fas fa-chart-bar me-2"></i>Enrollments Overview</h5>
            <div class="btn-group btn-group-sm" role="group">
              <button type="button" class="btn btn-outline-primary active" disabled>Last 6 Months</button>
            </div>
          </div>
            <div class="chart-body">
            <div class="bar-chart" *ngIf="analytics.enrollmentsByMonth.length > 0">
              <div class="chart-bars">
                <div class="bar-item" *ngFor="let month of analytics.enrollmentsByMonth">
                  <div class="bar-wrapper">
                    <div class="bar-fill"
                         [style.height.%]="getEnrollmentPercentage(month.enrollments)"
                         [title]="month.enrollments + ' enrollments'">
                    </div>
                  </div>
                  <div class="bar-label">{{ month.month }}</div>
                  <div class="bar-value">{{ month.enrollments }}</div>
                </div>
              </div>
            </div>
            <div *ngIf="analytics.enrollmentsByMonth.length === 0" class="text-center py-5 text-muted">
              <i class="fas fa-chart-bar fa-3x mb-3"></i>
              <p>No enrollment data available</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Users by Role -->
      <div class="col-lg-4 mb-4">
        <div class="chart-card">
          <div class="chart-header">
            <h5><i class="fas fa-tags me-2"></i>Courses by Category</h5>
          </div>
          <div class="chart-body">
            <div class="role-distribution" *ngIf="analytics.coursesByCategory.length > 0">
              <div class="role-item" *ngFor="let cat of analytics.coursesByCategory; let i = index">
                <div class="role-info">
                  <span class="role-name">{{ cat.categoryName }}</span>
                  <span class="role-count">{{ cat.coursesCount }}</span>
                </div>
                <div class="progress mb-2">
                  <div class="progress-bar"
                       [style.width.%]="getCategoryPercentage(cat.coursesCount)"
                       [style.background-color]="getCategoryColor(i)">
                  </div>
                </div>
                <small class="text-muted">{{ getCategoryPercentage(cat.coursesCount) | number:'1.1-1' }}%</small>
              </div>
            </div>
            <div *ngIf="analytics.coursesByCategory.length === 0" class="text-center py-5 text-muted">
              <i class="fas fa-tags fa-3x mb-3"></i>
              <p>No category data available</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Metrics -->
    <div class="row">
      <!-- Recent Enrollments -->
      <div class="col-lg-6 mb-4">
        <div class="metrics-card">
          <h5 class="mb-4"><i class="fas fa-user-check me-2"></i>Recent Enrollments</h5>
          <div class="table-responsive" *ngIf="analytics.recentEnrollments.length > 0">
            <table class="table table-sm table-hover">
              <thead>
                <tr>
                  <th>Student</th>
                  <th>Course</th>
                  <th>Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let enrollment of analytics.recentEnrollments">
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-user-circle me-2 text-primary"></i>
                      <span>{{ enrollment.studentName || 'Unknown Student' }}</span>
                    </div>
                  </td>
                  <td>
                    <small class="text-muted">{{ enrollment.courseName || 'Unknown Course' }}</small>
                  </td>
                  <td>
                    <small>{{ enrollment.enrollmentDate | date: 'shortDate' }}</small>
                  </td>
                  <td>
                    <span class="badge" 
                          [ngClass]="{
                            'bg-success': enrollment.status === 'Active',
                            'bg-primary': enrollment.status === 'Completed',
                            'bg-danger': enrollment.status === 'Cancelled'
                          }">
                      {{ enrollment.status }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div *ngIf="analytics.recentEnrollments.length === 0" class="text-center py-4 text-muted">
            <i class="fas fa-inbox fa-2x mb-3"></i>
            <p class="mb-0">No recent enrollments</p>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="col-lg-6 mb-4">
        <div class="metrics-card">
          <h5 class="mb-4"><i class="fas fa-clock me-2"></i>Performance Metrics</h5>
          <div class="metric-row">
            <div class="metric-label">Active Students</div>
            <div class="metric-value">{{ analytics.activeStudents | number }}</div>
          </div>
      <div class="metric-row">
        <div class="metric-label">Completion Rate</div>
        <div class="metric-value">
          {{ completionRate | number:'1.1-1' }}%
        </div>
      </div>


          <div class="metric-row">
            <div class="metric-label">Pending Instructor Verifications</div>
            <div class="metric-value">{{ analytics.pendingInstructors | number }}</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">Total Categories</div>
            <div class="metric-value">{{ analytics.totalCategories | number }}</div>
          </div>
          <div class="metric-row">
            <div class="metric-label">Recent Enrollments (Last 10)</div>
            <div class="metric-value">{{ analytics.recentEnrollments.length | number }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
